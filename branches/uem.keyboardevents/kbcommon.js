
// UEMKBD namespace is defined in other files.
UEMKB.maps = [
    [UEMKB.QWERTY,UEMKB.QWERTYix,UEMKB.QWERTYchgMap,UEMKB.QWERTYremMap,UEMKB.QWERTYaddMap],
    [UEMKB.QWERTZ,UEMKB.QWERTZix,UEMKB.QWERTZchgMap,UEMKB.QWERTZremMap,UEMKB.QWERTZaddMap],
    [UEMKB.Russian,UEMKB.Russianix,UEMKB.RussianchgMap,UEMKB.RussianremMap,UEMKB.RussianaddMap],
    [UEMKB.AZERTY,UEMKB.AZERTYix,UEMKB.AZERTYchgMap,UEMKB.AZERTYremMap,UEMKB.AZERTYaddMap],
    [UEMKB.Greek,UEMKB.Greekix,UEMKB.GreekchgMap,UEMKB.GreekremMap,UEMKB.GreekaddMap],
    [UEMKB.Serbian,UEMKB.Serbianix,UEMKB.SerbianchgMap,UEMKB.SerbianremMap,UEMKB.SerbianaddMap],
    [UEMKB.Armenian,UEMKB.Armenianix,UEMKB.ArmenianchgMap,UEMKB.ArmenianremMap,UEMKB.ArmenianaddMap],
    [UEMKB.Arabic,UEMKB.Arabicix,UEMKB.ArabicchgMap,UEMKB.ArabicremMap,UEMKB.ArabicaddMap],
    [UEMKB.Devanagari,UEMKB.Devanagariix,UEMKB.DevanagarichgMap,UEMKB.DevanagariremMap,UEMKB.DevanagariaddMap],
    [UEMKB.Bangali,UEMKB.Bengaliix,UEMKB.BengalichgMap,UEMKB.BengaliremMap,UEMKB.BengaliaddMap],
    [UEMKB.Turkish,UEMKB.Turkishix,UEMKB.TurkishchgMap,UEMKB.TurkishremMap,UEMKB.TurkishaddMap],
    [UEMKB.Bulgarian,UEMKB.Bulgarianix,UEMKB.BulgarianchgMap,UEMKB.BulgarianremMap,UEMKB.BulgarianaddMap],
    [UEMKB.DivehiPhonetic,UEMKB.DivehiPhoneticix,UEMKB.DivehiPhoneticchgMap,UEMKB.DivehiPhoneticremMap,UEMKB.DivehiPhoneticaddMap],
    [UEMKB.DivehiTypewriter,UEMKB.DivehiTypewriterix,UEMKB.DivehiTypewriterchgMap,UEMKB.DivehiTypewriterremMap,UEMKB.DivehiTypewriteraddMap],
    [UEMKB.Farsi,UEMKB.Farsiix,UEMKB.FarsichgMap,UEMKB.FarsiremMap,UEMKB.FarsiaddMap],
    [UEMKB.Georgian,UEMKB.Georgianix,UEMKB.GeorgianchgMap,UEMKB.GeorgianremMap,UEMKB.GeorgianaddMap],
    [UEMKB.Gujarati,UEMKB.Gujaratiix,UEMKB.GujaratichgMap,UEMKB.GujaratiremMap,UEMKB.GujaratiaddMap],
    [UEMKB.Hebrew,UEMKB.Hebrewix,UEMKB.HebrewchgMap,UEMKB.HebrewremMap,UEMKB.HebrewaddMap],
    [UEMKB.Japanese,UEMKB.Japaneseix,UEMKB.JapanesechgMap,UEMKB.JapaneseremMap,UEMKB.JapaneseaddMap],
    [UEMKB.Kannada,UEMKB.Kannadaix,UEMKB.KannadachgMap,UEMKB.KannadaremMap,UEMKB.KannadaaddMap],
    [UEMKB.Latvian,UEMKB.Latvianix,UEMKB.LatvianchgMap,UEMKB.LatvianremMap,UEMKB.LatvianaddMap],
    [UEMKB.Mongolian,UEMKB.Mongolianix,UEMKB.MongolianchgMap,UEMKB.MongolianremMap,UEMKB.MongolianaddMap],
    [UEMKB.Nepali,UEMKB.Nepaliix,UEMKB.NepalichgMap,UEMKB.NepaliremMap,UEMKB.NepaliaddMap],
    [UEMKB.Pashto,UEMKB.Pashtoix,UEMKB.PashtochgMap,UEMKB.PashtoremMap,UEMKB.PashtoaddMap],
    [UEMKB.Punjabi,UEMKB.Punjabiix,UEMKB.PunjabichgMap,UEMKB.PunjabiremMap,UEMKB.PunjabiaddMap],
    [UEMKB.Syriac,UEMKB.Syriacix,UEMKB.SyriacchgMap,UEMKB.SyriacremMap,UEMKB.SyriacaddMap],
    [UEMKB.SyriacPhonetic,UEMKB.SyriacPhoneticix,UEMKB.SyriacPhoneticchgMap,UEMKB.SyriacPhoneticremMap,UEMKB.SyriacPhoneticaddMap],
    [UEMKB.Tamil,UEMKB.Tamilix,UEMKB.TamilchgMap,UEMKB.TamilremMap,UEMKB.TamiladdMap],
    [UEMKB.ThaiKedmanee,UEMKB.ThaiKedmaneeix,UEMKB.ThaiKedmaneechgMap,UEMKB.ThaiKedmaneeremMap,UEMKB.ThaiKedmaneeaddMap],
    [UEMKB.ThaiPattachote,UEMKB.ThaiPattachoteix,UEMKB.ThaiPattachotechgMap,UEMKB.ThaiPattachoteremMap,UEMKB.ThaiPattachoteaddMap],
    [UEMKB.Telugu,UEMKB.Teluguix,UEMKB.TeluguchgMap,UEMKB.TeluguremMap,UEMKB.TeluguaddMap],
    [UEMKB.USDvorak,UEMKB.USDvorakix,UEMKB.USDvorakchgMap,UEMKB.USDvorakremMap,UEMKB.USDvorakaddMap],
    [UEMKB.Urdu,UEMKB.Urduix,UEMKB.UrduchgMap,UEMKB.UrduremMap,UEMKB.UrduaddMap]
]
// Keyboard layout.
// The layout can vary from window to window.  It is defined by
// the operating system at runtime and not by any property
// attached to the current document.
UEMKB.layout = "US";

// Browser.
// A two letter string used in constructing the map names
// used to convert key codes to character identifiers.
UEMKB.browser = "IE";

// Operating system.
// A three letter string used in constructing the map names
// used to convert key codes to character identifiers.
UEMKB.os = "Win";

if (document.createEventObject) {
    UEMKB.browser = "IE";
}
else if (navigator.product == "Gecko" && 
    navigator.vendor != "Apple Computer, Inc.") {
    UEMKB.browser = "FF";
}
else if (/safari/i.test(navigator.userAgent)) {
    UEMKB.browser = "SF";
}
else if (navigator.appName == "Opera") {
    UEMKB.browser = "OP";
}
if (navigator.userAgent.indexOf("Win")) {
    UEMKB.os = "Win";
}
else if (navigator.userAgent.indexOf("Mac")) {
    UEMKB.os = "Mac";
}
else if (Navigator.userAgent.indexOf("X11")) {
    UEMKB.os = "Lin";
}

// Map of keycode to key identifier for control keys.
UEMKB.kc2iCommon = {
    // Cancel
    "3":"U+0018",
    "8":"U+0008",
    "9":"U+0009",
    "12":"Clear",
    "13":"Enter",
    "16":"Shift",
    "17":"Control",
    "18":"Alt",
    "19":"Pause",
    "20":"CapsLock",
    "21":"HangulMode",
    "24":"FinalMode",
    "25":"KanjiMode",
    // Escape (Esc)
    "27":"U+001B",
    // Space (Spacebar)
    "32":"U+0020",
    "33":"PageUp",
    "34":"PageDown",
    "35":"End",
    "36":"Home",
    "37":"Left",
    "38":"Up",
    "39":"Right",
    "40":"Down",
    "41":"Select",
    "43":"Execute",
    "44":"PrintScreen",
    "45":"Insert",
    // Delete (Del)
    "46":"U+007F",
    "47":"Help",
    "91":"Win",
    "93":"Apps",
    "112":"F1",
    "113":"F2",
    "114":"F3",
    "115":"F4",
    "116":"F5",
    "117":"F6",
    "118":"F7",
    "119":"F8",
    "120":"F9",
    "121":"F10",
    "122":"F11",
    "123":"F12",
    "124":"F13",
    "125":"F14",
    "126":"F15",
    "127":"F16",
    "128":"F17",
    "129":"F18",
    "130":"F19",
    "131":"F20",
    "132":"F21",
    "133":"F22",
    "134":"F23",
    "135":"F24",
    "144":"NumLock",
    "145":"Scroll",
    "166":"BrowserBack",
    "167":"BrowserForward",
    "168":"BrowserRefresh",
    "169":"BrowserStop",
    "170":"BrowserSearch",
    "171":"BrowserFavorites",
    "172":"BrowserHome",
    "173":"VolumeMute",
    "174":"VolumeDown",
    "175":"VolumeUp",
    "176":"MediaNextTrack",
    "177":"MediaPreviousTrack",
    "178":"MediaStop",
    "179":"MediaPlayPause",
    "180":"LaunchMail",
    "181":"SelectMedia",
    "182":"LaunchApplication1",
    "183":"LaunchApplication2",
    "224":"Meta"
};

/**
 * Construct a key identifier to keycode map.  This map is used in initTextEvent
 * to assign keycodes to keypress events.  The method works by inverting the
 * map defined by a primary map, secondary change map, secondary remove map,
 * and secondary add map.
 */
UEMKB.invkctoi = function() {
    var kc;
    var kcrem;
    var value;
    var stillin = 1;
    var ret = new Object();
    for (kc in UEMKB.primaryMap) {
        value = UEMKB.primaryMap[kc];
        stillin = 1;
        for (kcrem in UEMKB.chgMap) {
            if (kcrem == kc) {
                stillin = 0;
                break;
            }
        }
        if (stillin == 1) {
            ret["U+" + value] = kc;
        }
    }
    for (kc in UEMKB.addMap) {
        value = UEMKB.addMap[kc];
        ret["U+" + value] = kc;
    }
    for (kc in UEMKB.chgMap) {
        value = UEMKB.chgMap[kc];
        ret["U+" + value] = kc;
    }
    for (kc in UEMKB.kc2icommon) {
        value = UEMKB.kc2icommon[kc];
        ret[value] = kc;
    }
    return ret;
};

// Default assignment for the primary map, secondary change map, secondary remove map,
// and secondary add map.  These define a compact mapping of keycode to key identifier.
UEMKB.primaryMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][0];
UEMKB.layoutType=UEMKB.maps[UEMKB.ix[UEMKB.layout]][1][UEMKB.browser + UEMKB.layout];
UEMKB.chgMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][2][UEMKB.layoutType];
UEMKB.remMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][3][UEMKB.layoutType];
UEMKB.addMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][4][UEMKB.layoutType];

// The mapping from key identifier to keycode.
UEMKB.itokc = UEMKB.invkctoi();

/**
 * Given a layout, set the primary map, secondary change map, secondary remove map,
 * and secondary add map.
 */
UEMKB.setLayout = function(layoutArg) {
    if (layoutArg && (layoutArg != UEMKB.layout) && UEMKB.ix[layoutArg]) {
        UEMKB.layout = layoutArg;
        UEMKB.primaryMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][0];
        UEMKB.layoutType=UEMKB.maps[UEMKB.ix[UEMKB.layout]][1][UEMKB.browser + UEMKB.layout];
        UEMKB.chgMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][2][UEMKB.layoutType];
        UEMKB.remMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][3][UEMKB.layoutType];
        UEMKB.addMap = UEMKB.maps[UEMKB.ix[UEMKB.layout]][4][UEMKB.layoutType];
        UEMKB.itokc = UEMKB.invkctoi();
    }
};

UEMKB.getLayout = function() {
    return UEMKB.layout;
};

UEMKB.kctoi = function(keycode) {
    var kc = 0;
    kc = keycode;
    var kcs = kc.toString(10);
    var xmap = UEMKB.kc2iCommon[kcs];
    if (!xmap) {
        xmap = UEMKB.addMap[kcs];
        if (!xmap) {
            xmap = UEMKB.chgMap[kcs];
            if (!xmap) {
                xmap = UEMKB.primaryMap[kcs];
                if (!xmap) {
                    xmap = "U+0000";
                }
                else {
                    xmap = "U+" + xmap;
                }
            }
            else {
                xmap = "U+" + xmap;
            }
        }
        else {
            xmap = "U+" + xmap;
        }
    }
    return xmap;
};


